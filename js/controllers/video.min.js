"use strict";angular.module("camomileApp.controllers.video",["ngSanitize","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","rzModule"]).constant("camomileConfigVideo",{canvas:{fillColor:"#f00",strokeColor:"#f00"}}).directive("camomileVideo",function(){return{templateUrl:"views/video.html",restrict:"E",scope:{src:"="}}}).controller("VideoCtrl",function(e,t,n,o){e.API=void 0,e.Math=window.Math,e.slider={value:0,lastValue:0,options:{floor:0,ceil:void 0,translate:function(t){var n=e.Math.floor(t/60),o=t%60;return 10>n&&(n="0"+n),10>o&&(o="0"+o),n+":"+o}}},e.onPlayerReady=function(t){e.API=t},e.alertTimestamp=function(){window.alert(e.API.currentTime)},e.videoPlay=function(){e.API.play()},e.videoPause=function(){e.API.pause()},e.videoStop=function(){e.API.pause(),e.API.seekTime(100,!0)},e.videoBegin=function(){e.API.pause(),e.API.seekTime(0,!0)},e.videoEnd=function(){e.API.pause(),e.API.seekTime(100,!0)},e.nextFrame=function(){var t=e.API.currentTime;e.API.seekTime(t/1e3+.04,!1)},e.previousFrame=function(){var t=e.API.currentTime;e.API.seekTime(t/1e3-.04,!1)},e.nextSecond=function(){var t=e.API.currentTime;e.API.seekTime(t/1e3+1,!1)},e.previousSecond=function(){var t=e.API.currentTime;e.API.seekTime(t/1e3-1,!1)},e.testFrame=function(){},e.annotation={},e.annotation.points=[],e.annotation.drawStyle="free",e.canvas=window.document.getElementById("transparent-plan"),e.context=e.canvas.getContext("2d"),e.context.strokeStyle=o.canvas.strokeColor,e.context.fillStyle=o.canvas.fillColor,e.setupCanvas=function(){e.clearCanvas();var t=e.annotation.points;if(t.length>1){if(e.context.beginPath(),"rectangle"==e.annotation.drawStyle){var n=t[1].x-t[0].x,o=t[1].y-t[0].y;e.context.rect(t[0].x,t[0].y,n,o)}else if("circle"==e.annotation.drawStyle){var a=e.Math,i=a.abs(a.sqrt(a.pow(t[0].x-t[1].x,2)+a.pow(t[0].y-t[1].y,2)));e.context.arc(t[0].x,t[0].y,i,0,2*Math.PI)}else if("free"==e.annotation.drawStyle){e.context.moveTo(t[0].x,t[0].y);var r=!0,l=!1,c=void 0;try{for(var s,u=t.slice(1,t.length)[Symbol.iterator]();!(r=(s=u.next()).done);r=!0)p=s.value,e.context.lineTo(p.x,p.y)}catch(d){l=!0,c=d}finally{try{!r&&u["return"]&&u["return"]()}finally{if(l)throw c}}}e.context.stroke(),e.context.closePath()}else 1==t.length&&(e.context.beginPath(),e.context.arc(t[0].x,t[0].y,1,0,2*Math.PI),e.context.fill(),e.context.closePath())},e.annotation.isComplete=function(){return"rectangle"==e.annotation.drawStyle&&e.annotation.points.length>1?!0:"circle"==e.annotation.drawStyle&&e.annotation.points.length>1?!0:"free"==e.annotation.drawStyle&&e.annotation.points.length>9?!0:!1},e.clearCanvas=function(t){t=void 0!==t?t:!1,t&&(e.annotation.points=[]),e.context.clearRect(0,0,e.canvas.width,e.canvas.height)},e.setupCanvas(),e.addOnClick=function(t){var n=t.offsetX,o=t.offsetY;e.annotation.isComplete()||e.annotation.points.push({x:n,y:o}),e.setupCanvas()},n(function(){if(e.API){var t=e.slider.value,n=e.slider.lastValue;t!=n?e.API.seekTime(e.slider.value,!1):e.slider.value=e.Math.floor(e.API.currentTime/1e3),e.slider.options.ceil||(e.slider.options.ceil=e.Math.floor(e.API.totalTime/1e3))}e.slider.lastValue=e.slider.value},200)});
